# Проект: Тестирование базы данных с использованием db-dog
Этот репозиторий создан для того, чтобы на простом примере потренироваться тестировать взаимодействие с базой данных с
использованием библиотеки `data-dog` (на основе `sqlmock`).
Мы рассмотрим, как писать unit-тесты для методов, которые работают с базой данных, и как использовать mock-объекты
для эмуляции её поведения.

## Цель проекта
Наглядно продемонстрировать, как можно тестировать код, взаимодействующий с базой данных,
без необходимости подключения к реальной БД. Мы используем библиотеку db-dog (и её основу — sqlmock), чтобы:

- Создавать mock-объекты для базы данных.
- Эмулировать различные сценарии (успешные запросы, ошибки и т.д.).
- Убедиться, что наш код корректно обрабатывает все возможные ситуации.

Этот проект поможет вам понять, как писать тесты для приложений, которые активно используют базу данных,
и как делать это эффективно.

## Как запустить проект
**Требования**
- Установленный Go (версия 1.16 или выше).
- Установленные зависимости: `Gin`, `sqlx`, `DATA-DOG`, `sqlmock`.
- Установка зависимостей

```bash
go get -u github.com/gin-gonic/gin
go get -u github.com/jmoiron/sqlx
go get -u github.com/DATA-DOG/go-sqlmock
```

## Описание функционала приложения
Приложение представляет собой простой HTTP-сервер на базе фреймворка Gin, который предоставляет несколько эндпоинт
- Получение списка задач из базы данных. `GET /tasks`
- Получение одной задачи из базы данных. `GET /task/{id}`
- Изменение задачи `POST /task/{id}`
- Удаление задачи `DELETE /tasks/{id}`

## Тестирование `GET /tasks`:
_Получение списка задач:_

**Эндпоинт:** `GET /tasks`

**Описание:** Возвращает список всех задач из базы данных в формате JSON.

**Пример ответа:**

```json
[
    {
        "id": 1,
        "title": "Task 1",
        "done": false
    },
    {
        "id": 2,
        "title": "Task 2",
        "done": true
    }
]
```

### Использование базы данных:

Приложение использует библиотеку sqlx для работы с базой данных.
В коде реализован метод GetTasks, который выполняет SQL-запрос и возвращает данные.

Собственно тестирование:

Для тестирования используется библиотека `data-dog` (на основе `sqlmock`).

### Как работает тестирование
Мы используем data-dog для создания mock-объектов базы данных. Это позволяет:

- Эмулировать выполнение SQL-запросов.
- Задавать ожидаемые результаты (например, возвращаемые строки или ошибки).
- Проверять, что код корректно обрабатывает все возможные сценарии.

Пример теста с комментариями можно найти в папке `internal/test`

## Запуск тестов
Чтобы запустить тесты, из корня проекта выполните команду:

```bash
go test ./internal/test -v
```

## Лицензия
Этот проект распространяется под лицензией LGPL. Подробности см. в файле LICENSE.